name: Release
on:
  workflow_dispatch: 

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master'
    steps:
        - uses: actions/checkout@v3
        - name: Set up Maven Central Repository
          uses: actions/setup-java@v3
          with:
            java-version: '17'
            distribution: 'temurin'
            server-id: ossrh
            server-username: MAVEN_USERNAME
            server-password: MAVEN_PASSWORD
            gpg-private-key: ${{ secrets.GPG_PRIVATE_KEY }}
            gpg-passphrase: MAVEN_GPG_PASSPHRASE
        - name: Publish package
          run: mvn --batch-mode -f pom.xml deploy -PossrhDeploy 
          env:
            MAVEN_USERNAME: ${{ secrets.NEXUS_USERNAME }}
            MAVEN_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}
            MAVEN_GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
            MAVEN_OPTS: "--add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.text=ALL-UNNAMED --add-opens=java.desktop/java.awt.font=ALL-UNNAMED"
